<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Monitor Ascensor - Firebase Live</title>
<style>
    body { font-family: Arial, sans-serif; background: #f5f5f5; padding: 20px; }
    h1 { text-align: center; }
    #log { background: white; padding: 15px; border-radius: 10px;
           box-shadow: 0 0 10px rgba(0,0,0,0.2); max-width: 700px; margin: auto; }
    .item { padding: 8px; border-bottom: 1px solid #ddd; }
    .time { color: #777; font-size: 0.8em; }
</style>
</head>
<body>

<h1>ðŸ“¡ Monitor Ascensor ESP32 â€“ Firebase en Tiempo Real</h1>
<div id="log">Cargando datos...</div>

<!-- SDK de Firebase -->
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

<script>
// =============================
// CONFIGURACIÃ“N FIREBASE
// =============================
const firebaseConfig = {
    apiKey: "AIzaSyAU31I1rNQCDLxG-ayjKS61uTo6oUuCmCA",
    authDomain: "monitor-ascensor.firebaseapp.com",
    databaseURL: "https://monitor-ascensor-default-rtdb.firebaseio.com",
    projectId: "monitor-ascensor",
    storageBucket: "monitor-ascensor.firebasestorage.app",
    messagingSenderId: "64032364230",
    appId: "1:64032364230:web:8afb090f6debefeccfa9c7"
};

firebase.initializeApp(firebaseConfig);

// =============================
// LEER MENSAJES EN TIEMPO REAL
// =============================
const logDiv = document.getElementById("log");

firebase.database().ref("messages").on("value", snapshot => {
    const data = snapshot.val();
    if (!data) {
        logDiv.innerHTML = "AÃºn no hay mensajes...";
        return;
    }

    let html = "";
    const keys = Object.keys(data).reverse(); // Ãšltimos mensajes arriba

    keys.forEach(id => {
        const msg = data[id];
        let fecha = new Date(msg.ts).toLocaleString("es-BO");

        html += `
            <div class="item">
                <b>${msg.mensaje}</b><br>
                Piso: ${msg.piso} | Estado: ${msg.estado}<br>
                <span class="time">${fecha}</span>
            </div>
        `;
    });

    logDiv.innerHTML = html;
});
</script>

</body>
</html>
