<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Monitoreo Ascensor ESP32</title>
<style>
  body { font-family: Arial, sans-serif; margin:0; padding:0; display:flex; height:100vh; }
  #logs { width:40%; padding:10px; border-right:2px solid #333; overflow-y:scroll; background:#f0f0f0; }
  #ascensor { flex:1; position:relative; background:#e0e0ff; display:flex; justify-content:center; align-items:flex-end; }
  .piso { position:absolute; width:100%; height:33.33%; border-top:1px solid #999; box-sizing:border-box; }
  .cabina { width:60px; height:60px; background:red; position:absolute; bottom:0; transition:bottom 1s; display:flex; justify-content:center; align-items:center; color:white; font-weight:bold; }
</style>
</head>
<body>

<div id="logs"><h3>Logs en tiempo real</h3></div>
<div id="ascensor">
  <div class="piso" style="bottom:0%;"></div>
  <div class="piso" style="bottom:33.33%;"></div>
  <div class="piso" style="bottom:66.66%;"></div>
  <div class="cabina" id="cabina">1</div>
</div>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>

<script>
  // Configuración Firebase
  const firebaseConfig = {
    apiKey: "AIzaSyAU31I1rNQCDLxG-ayjKS61uTo6oUuCmCA",
    authDomain: "monitor-ascensor.firebaseapp.com",
    databaseURL: "https://monitor-ascensor-default-rtdb.firebaseio.com",
    projectId: "monitor-ascensor",
    storageBucket: "monitor-ascensor.appspot.com",
    messagingSenderId: "64032364230",
    appId: "1:64032364230:web:8afb090f6debefeccfa9c7"
  };

  // Inicializar Firebase
  firebase.initializeApp(firebaseConfig);
  const dbRef = firebase.database().ref('messages');

  const logsDiv = document.getElementById('logs');
  const cabina = document.getElementById('cabina');

  // Función para actualizar posición de cabina según piso
  function actualizarCabina(piso) {
    let bottomPercent = 0;
    if (piso == 1) bottomPercent = 0;
    if (piso == 2) bottomPercent = 33.33;
    if (piso == 3) bottomPercent = 66.66;
    cabina.style.bottom = bottomPercent + '%';
    cabina.textContent = piso;
  }

  // Escuchar cambios en Firebase en tiempo real
  dbRef.on('child_added', (snapshot) => {
    const data = snapshot.val();
    const mensaje = data.mensaje || '';
    const piso = data.piso || 1;
    const ts = data.ts || Date.now();

    // Crear un div por mensaje con etiqueta y clasificado por piso
    const msgDiv = document.createElement('div');
    msgDiv.textContent = `[Piso ${piso}] ${mensaje} - ${new Date(ts).toLocaleTimeString()}`;
    msgDiv.setAttribute('data-piso', piso);
    logsDiv.appendChild(msgDiv);
    logsDiv.scrollTop = logsDiv.scrollHeight;

    // Actualizar cabina si mensaje indica movimiento
    if (mensaje.includes('Subiendo') || mensaje.includes('Bajando') || mensaje.includes('Piso')) {
      actualizarCabina(piso);
    }
  });
</script>

</body>
</html>
